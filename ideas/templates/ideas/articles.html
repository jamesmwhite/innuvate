{% extends "base.html" %}
{% block content %}
<html>
<head>
        <style type="text/css">
            body, html { font-family:helvetica,arial,sans-serif; font-size:90%; color:#1c94c4 }
        </style>		
		<script>
			$(function() {
				$( "button, input:submit, a", ".submitdiv" ).button();
				$( "a", ".submitdev" ).click(function() { return false; });
			});
		</script>
		<script>
			$(function() {
				$( "#tabsu" ).tabs();
				$( ".tabs-bottom .ui-tabs-nav, .tabs-bottom .ui-tabs-nav > *" )
					.removeClass( "ui-corner-all ui-corner-top" )
					.addClass( "ui-corner-bottom" );
			});
		</script>
		<style>
			#tabsu { height: 200px; width:400px} 
			.tabs-bottom { position: relative; } 
			.tabs-bottom .ui-tabs-panel { height: 200px; overflow: auto; width:400px} 
			.tabs-bottom .ui-tabs-nav { position: absolute !important; left: 0; bottom: 0; right:0; padding: 0 0.2em 0.2em 0; } 
			.tabs-bottom .ui-tabs-nav li { margin-top: -2px !important; margin-bottom: 1px !important; border-top: none; border-bottom-width: 1px; }
			.ui-tabs-selected { margin-top: -3px !important; }
		</style>
		<script>
			$(function() {
				$( "#accordion" ).accordion({										
				});
			});
		</script>
		<script>
			$('myForm').addEvent('submit', function(e) {
			new Event(e).stop();
			var log = $('log_res').empty().addClass('ajax-loading');
			this.send({
				update: log,
				onComplete: function() {
					log.removeClass('ajax-loading');
				}
			});
		});
		</script>
		
</head>

<body>  
<h3 class="ui-widget-header ui-corner-all">Articles</h3>
	<table width="100%" cellspacing="30">
	{%if articles%}
	<tr>
	<td><b>Article</b></td>
	<td><b>Tags</b></td>
	<td><b>User</b></td>
	<td width="10%"></td>
	<td width="10%"></td>
	<td><b>Vote</b></td>
	</tr>
	{%else%}
	No articles submitted
	{%endif%}
	{%for art in articles%}
	<tr>
	<td><a href="{{art.url}}" target="_blank">{{art.title}}</a></td>
	<td>{%for tag in art.tags%}{{tag}} {%endfor%}</td>
	<td>{{art.author}}</td>
	<td>
	{%if user.is_authenticated%}

						{%if not art.hasvoted%}
							<form action="/voteart/" method="post">
								<div class="submitdiv">
									<input type="hidden" name="id" value={{art.id}}>
									<input type="hidden" name="vote" value="like">
									<input align="middle" type="image" src="/media/images/thumb_up.png" HEIGHT="40" WIDTH="40" BORDER="0" ALT="Submit Form"/>
								</div>
							</form>
							{%else%}
							Already Voted!
							{%endif%}
						{%endif%}
	</td>
	<td>
	{%if user.is_authenticated%}
					{%if not art.hasvoted%}
						<form action="/voteart/" method="post">
							<div class="submitdiv">
								<input type="hidden" name="id" value={{art.id}}>
								<input type="hidden" name="vote" value="nolike">
								<input align="middle" type="image" src="/media/images/thumb_down.png" HEIGHT="40" WIDTH="40" BORDER="0" ALT="Submit Form"/>
							</div>											
						</form>
						{%else%}

							{%endif%}
					{%endif%}
	</td>
	<td><votecount>{{art.votecount}}</votecount></td>
	<td>				
			<font size="1" color="red"><a href="/reportarticle/{{art.id}}">report</a></font>
	</td>
	</tr>
	{%endfor%}
	</table>
	<hr/>
	<h3 class="ui-widget-header ui-corner-all">Submit New Article</h3>
	{%if user.is_authenticated%}
		<form id="myForm" action="/submitarticle/" method="post">
			<div id="form_box">
				<div>					
					<ideahead>Title:</ideahead><br/><input type="text" name="title" size="60" placeholder="Article title"/>
				</div>
				<div>
					<ideahead>Url:</ideahead><br/><input type="text" size="60" name="url" placeholder="http://www.example.com/article.html"/>
				</div>
				<div>										
					<ideahead>Tags:</ideahead><br/><input type="text" name="tags" size="60" placeholder="research,innovation,business"/>
					</br>
					<font size="1">Tag article with comma separated list (e.g. mobile,finance,marketing)</font>
				</div>
				<input type="submit" name="button" id="submitter" />
			<span class="clr"><!-- spanner --></span>
			</div>
		</form>
		<a href="/accounts/logout/?next=/">logout</a>
	{%else%}
	To submit articles, you must <a href="/accounts/login/?next=/">login</a> or if you are a new user
		
		<a href="/accounts/register/">register</a>.

	{%endif%}
</body>
</html>

<script>
$(document).ready(function() {

$.ajaxSetup({ 
     beforeSend: function(xhr, settings) {
         function getCookie(name) {
             var cookieValue = null;
             if (document.cookie && document.cookie != '') {
                 var cookies = document.cookie.split(';');
                 for (var i = 0; i < cookies.length; i++) {
                     var cookie = jQuery.trim(cookies[i]);
                     // Does this cookie string begin with the name we want?
                 if (cookie.substring(0, name.length + 1) == (name + '=')) {
                     cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                     break;
                 }
             }
         }
         return cookieValue;
         }
         if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
             // Only send the token to relative URLs i.e. locally.
             xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
         }
     } 
});


  var initialTitleChange = true;
  var initialSlugChange = true;

  var perform_update = function(field, val) {
    var data = {};
    data[field] = val;
    var args = { type:"POST", url:"update/", data:data, complete:done };
    $.ajax(args);
  };

  var done = function(res, status) {
    if (status == "success") display_success("Updated successfully.", $(".text"));
    else display_error(res.responseText, $(".text"));
  }


});

</script>

{% endblock %}